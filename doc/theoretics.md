# RESTful services (express/restify)

[Перейти до практики](https://github.com/VitaliiZZzz/restful-services/edit/master/doc/examples.md)

[Автори доповіді](https://github.com/VitaliiZZzz/restful-services/edit/master/Authors.md)

## Що таке REST?

Представлення (representation) – спосіб ілюстрації чи опису об’єкта. Наприклад, за допомогою атрибутів, за допомогою математичної моделі:

```
booksRepresentation = [
    {id: *, name: *, author: *, year: *, pagesCount: *},
    {id: *, name: *, author: *, year: *, pagesCount: *},
    {id: *, name: *, author: *, year: *, pagesCount: *},
    ...
]
```

Стан (state) – ілюстрація чи опис об’єкта в зафіксований момент часу. Наприклад, конкретні значення атрибутів:

```
booksRepresentation = [
    {id: 1, name: 'book1', author: 'author1', year: '2021', pagesCount: 125},
    {id: 2, name: 'book2', author: 'author2', year: '2021', pagesCount: 217},
    {id: 3, name: 'book3', author: 'author3', year: '2021', pagesCount: 301}
]
```

REST (Representation State Transfer) - це архітектурний стиль, що полягає в передачі стану представлення за допомогою HTTP. Увага: REST - це лише задумка, ідея, теорія.

REST API - це технічна реалізація архітектурного стилю REST. Приклад відповіді від REST API:

```
HTTP/1.1 200 OK
Server: Express
Content-Language: uk
Content-Type: application/json; charset=utf-8
Content-Length: 223
[
    {
        "id": 1,
        "name": "book1",
        "author": "author1",
        "year": "2021",
        "pagesCount": 125
    },
    {
        "id": 2,
        "name": "book2",
        "author": "author2",
        "year": "2021",
        "pagesCount": 217
    },
    {
        "id": 3,
        "name": "book3",
        "author": "author3",
        "year": "2021",
        "pagesCount": 301
    }
]
```

RESTful service - це веб-сервіс, що побудований на REST та має REST API.

Важливою особливістю сервісів REST є те, що саме HTTP протокол використовується для пересилання стану представлення.

## Коротко про HTTP

HTTP - це протокол, що надає можливість віддалено виконувати операції (create, read, update, delete - CRUD) над різноманітними ресурсами.

Ресурс - це узагальнене поняття, тобто все, що ви хочете показати зовнішньому світові через вашу програму. Наприклад:
* Конкретна сутність (entity)
* Конкретна задача
* Список задач

Кожен ресурс має свій ідентифікатор (URI - універсальний ідентифікатор ресурсів). Наприклад:
* /books
* /students/Ivan
* /cars/Mercedes
* /trucks/MAN/1

Увага!
1. Множина URI (Universal Resource Identifier) включає в себе множини URL (Uniform Resource Locator) та URN (Uniform Resource Name).
2. URI-адреса ніяк не прив'язана до адреси у файловій системі. Наприклад, ресурси з URI "/books", "/university/departments", "/university/departments/fict/students/testgroup/3" можуть знаходитись в одній і тій же папці "D:\example". В такому контексті URI більше схожа на ключ типу даних String для асоціативного масиву (словника - {key:value}).
3. URI варто створювати тоді, коли було означено множину ресурсів, а множина ресурсів виділяється тоді, коли була створена BE-модель.

## Запит-відповідь в HTTP

Для того, щоб з ресурсами виконати CRUD-дії необхідно їх знайти за URI та передати їм вхідні параметри. Для цього використовується запит. Щоб отримати результат CRUD-дій, використовуються відповіді.

Запити та відповіді для зручності будуються за певним шаблоном.

![image1](https://github.com/VitaliiZZzz/restful-services/blob/master/doc/images/request_response.png)

Middlewave (проміжний обробник) – це одна або декілька програм, підпрограм чи функцій, які виконують другорядні задачі в процесі пересилання запиту та відповіді. Наприклад: створення логів запитів, створення логів відповідей, парсинг тіла запитів, зміна формату даних в тілі відповіді тощо.

Endpoint (кінцева вершина) – це програма, підпрограма, чи функція, яка закінчує pipeline запиту, безпосередньо викликає CRUD-операцію для ресурсу та формує відповідь.

Route (маршрут) – це сукупність endpoint-ів, що працюють з одним і тим же ресурсом (в параметрах endpoint-ів вказаний один і той самий URI).

### Будова запиту в HTTP

HTTP визначає наступну структуру запиту (request):

```
GET /wiki/HTTP HTTP/1.1
Host: uk.wikipedia.org
User-Agent: firefox/5.0 (Linux; Debian 5.0.8; en-US; rv:1.8.1.7) Gecko/20070914 Firefox/2.0.0.7
Connection: close
(пустий рядок)
```

* рядок запиту (request line) - визначає тип повідомлення
* заголовки запиту (header fields) - характеризують тіло повідомлення, параметри передачі та інші відомості
* тіло повідомлення (body) - необов'язкове

### Будова відповіді в HTTP

HTTP визначає наступну структуру відповідного повідомлення (response):

```
HTTP/1.1 200 OK
Server: Apache
Content-Language: uk
Content-Type: text/html; charset=utf-8
Content-Length: 1234
(пустий рядок)
```

* рядок стану (status line), що включає код стану та повідомлення про причини
* поля заголовка відповіді (header fields)
* додаткове тіло повідомлення (body)

### Типи HTTP-запитів

Тип, який міститься в HTTP-запиті, вказує на необхідну операцію з обраним ресурсом. (Дані типи лише вказують, а не виконують дії)
```
GET /movies/3
POST /movies
PUT /movies/2
DELETE /movies/1
```
* GET: отримати детальну інформацію про ресурс (вказує на Read)
* POST: створити новий ресурс (вказує на Create)
* PUT: оновити існуючий ресурс (вказує на Update)
* DELETE: видалити ресурс (вказує на Delete)

### Опис якості виконання запиту у HTTP 
Для опису якості виконання запиту у HTTP протоколі розроблено асоціативний масив {status code: status text}. Код стану (status code) повертається у рядку стану (status line) HTTP-відповіді. Браузер, що зберігає асоціативний масив {status code: status text}, за отриманим кодом виводить [текстовий опис](https://upload.wikimedia.org/wikipedia/commons/0/09/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D1%96%D0%B2_%D1%81%D1%82%D0%B0%D0%BD%D1%83_HTTP.pdf) стану HTTP-запиту. Веб-сервіс може також використовувати власний текстовий опис стану HTTP-запиту. Наприклад:

![image1](https://github.com/VitaliiZZzz/restful-services/blob/master/doc/images/example404.png)

## Порівняння REST та HTTP

| Ознака | HTTP | REST |
| :--------: | :---: | :----: |
| Відправник / отримувач запитів | Браузер | Мобільний додаток, Десктопний додаток, Вебсайт і т.д. |
| Ідентифікація ресурсів | Через URI | Через URI |
| Характер ресурсів | HTML-, CSS-, Javascript- файли | JSON, XML, інші формати даних (“pure-data”) |
| Дієслова запиту до CRUD-операцій | GET, POST, PUT, DELETE | GET, POST, PUT, DELETE |
| Швидкість завантаження | Нижча | Вища |

### Коментар до таблиці
1. Множина Restful-сервісів має більший обсяг, ніж множина реалізаторів HTTP. Звідси слідує, що REST гнучкий. 
2. Ідентифікація ресурсів у REST така ж, як і у HTTP, через URI. 
3. RESTful сервіси пересилають в запиті-відповіді лише ресурси (“pure-data”), без технічного коду.   
4. REST використовує дієслова, вже визначені протоколом HTTP, для доступу до CRUD-операцій.
5. Оскільки діє правило 3, то швидкість передачі та завантаження даних в RESTful сервісах вища.

## Express.js vs Restify.js

### Express

Express.js - вільне і відкрите програмне забезпечення під ліцензією MIT, фреймворк веб-додатків для Node.js, є backend'ом в стеці MEAN. Автор TJ Holowaychuk.

### Restify

Restify.js - вільне і відкрите програмне забезпечення під ліцензією MIT. Цей фреймворк оптимізований для створення семантично коректних веб-служб RESTful, готових до масштабного використання. Автор Mark Cavage.

### Порівняння

|            | Плюси | Мінуси |
| :--------: | :---: | :----: |
| Express.js | 1. Низький поріг входження, Express - це практично стандарт Node.js-додатку. | 1. Всі ресурси необхідно створювати вручну і, в результаті, з'явиться багато повторного коду або гірше - власна бібліотека. |
|            | 2. Повна кастомізація | 2. Кожен ресурс вимагає тестування або простої перевірки на 500-ту помилку. |
|            | 3. Розвинена спільнота | 3. Рефакторинг стане болючим, тому що буде необхідно правити все і всюди. |
|            | 4. Потужна документація | 4. Нема стандартного підходу, потрібно шукати свій. |
|            |  | 5. Швидкість роботи |
| Restify.js | 1. Підтримка DTrace, якщо API працює на платформі, яка його підтримує. | Мінуси такі ж як і у Express (окрім швидкості роботи) - багато зайвої праці. |
|            | 2. Немає такого зайвого функціоналу, як шаблони і рендеринг. |  |
|            | 3. Обмеження частоти запитів (throttling). |  |
|            | 4. Підтримка SPDY |  |

![image2](https://github.com/VitaliiZZzz/restful-services/blob/master/doc/images/json_handings.png)
